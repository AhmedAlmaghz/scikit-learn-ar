.. _density_estimation:

==================
تقدير الكثافة
==================
.. sectionauthor:: Jake Vanderplas <vanderplas@astro.washington.edu>

تقدير الكثافة يقع على الخط الفاصل بين التعلم غير الخاضع للإشراف، والهندسة المميزة، ونمذجة البيانات. بعض من أكثر تقنيات تقدير الكثافة شيوعًا وفائدة هي نماذج الخليط مثل
خليط غاوسي (:class:`~sklearn.mixture.GaussianMixture`)، ونهج الجار مثل تقدير الكثافة النواة
(:class:`~sklearn.neighbors.KernelDensity`).
يتم مناقشة خليط غاوسي بشكل كامل في سياق
:ref:`التجميع <clustering>`، لأن التقنية مفيدة أيضًا كنظام تجميع غير خاضع للإشراف.

تقدير الكثافة هو مفهوم بسيط جدًا، ومعظم الناس على دراية بالفعل بأسلوب واحد شائع لتقدير الكثافة: الرسم البياني.

تقدير الكثافة: الرسوم البيانية
==============================
الرسم البياني هو تصور بسيط للبيانات حيث يتم تحديد الصناديق، ويتم حساب عدد نقاط البيانات داخل كل صندوق. يمكن رؤية مثال على الرسم البياني في اللوحة العلوية اليسرى من الشكل التالي:

.. |hist_to_kde| image:: ../auto_examples/neighbors/images/sphx_glr_plot_kde_1d_001.png
   :target: ../auto_examples/neighbors/plot_kde_1d.html
   :scale: 80

.. centered:: |hist_to_kde|

ومع ذلك، فإن إحدى المشكلات الرئيسية في الرسوم البيانية هي أن اختيار التقسيم يمكن أن يكون له تأثير غير متناسب على التصور الناتج. ضع في اعتبارك اللوحة العلوية اليمنى من الشكل أعلاه. إنه يُظهر رسمًا بيانيًا على نفس البيانات، مع إزاحة الصناديق إلى اليمين. تبدو نتائج التصورين مختلفين تمامًا، وقد يؤدي ذلك إلى تفسيرات مختلفة للبيانات.

بشكل بديهي، يمكن للمرء أيضًا التفكير في الرسم البياني على أنه مجموعة من الكتل، كتلة واحدة لكل نقطة. من خلال تكديس الكتل في مساحة الشبكة المناسبة، نقوم باستعادة الرسم البياني. ولكن ماذا لو، بدلاً من تكديس الكتل على شبكة منتظمة، قمنا بمركز كل كتلة على النقطة التي تمثلها، وقمنا بجمع إجمالي الارتفاع في كل موقع؟ يؤدي هذا الفكر إلى التصور السفلي الأيسر. ربما لا يكون نظيفًا مثل الرسم البياني، ولكن حقيقة أن البيانات تدفع مواقع الكتلة تعني أنه تمثيل أفضل بكثير للبيانات الأساسية.

يُعد هذا التصور مثالاً على *تقدير كثافة النواة*، في هذه الحالة مع نواة القبعة العلوية (أي كتلة مربعة في كل نقطة). يمكننا استرداد توزيع أكثر سلاسة باستخدام نواة أكثر سلاسة. تعرض اللوحة السفلية اليمنى تقدير كثافة النواة الغاوسية، حيث تساهم كل نقطة بمنحنى غاوسي في الإجمالي. والنتيجة هي تقدير كثافة سلس مشتق من البيانات، ويعمل كنموذج غير بارامتري قوي لتوزيع النقاط.

.. _kernel_density:

تقدير كثافة النواة
 ==============
  يتم تنفيذ تقدير كثافة النواة في scikit-learn في أداة التقييم :class:`~sklearn.neighbors.KernelDensity` ، والتي تستخدم شجرة الكرة أو شجرة KD للاستعلامات الفعالة (انظر :ref:`neighbors`  لمناقشة هذه المواضيع). على الرغم من أن المثال السابق يستخدم مجموعة بيانات أحادية البعد للبساطة ، إلا أنه يمكن إجراء تقدير كثافة النواة في أي عدد من الأبعاد ، على الرغم من أن لعنة الأبعاد تسبب في الواقع تدهور أدائها في الأبعاد العالية.

    في الشكل التالي ، يتم رسم 100 نقطة من توزيع ثنائي النمط ، وتظهر تقديرات كثافة النواة لثلاثة خيارات من النواة:

    .. |kde_1d_distribution| image:: ../auto_examples/neighbors/images/sphx_glr_plot_kde_1d_003.png
       :target: ../auto_examples/neighbors/plot_kde_1d.html
       :scale: 80

    .. centered:: |kde_1d_distribution|

    من الواضح كيف يؤثر شكل النواة على نعومة التوزيع الناتج. يمكن استخدام أداة تقدير كثافة النواة في scikit-learn كما يلي:

       >>> from sklearn.neighbors import KernelDensity
       >>> import numpy as np
       >>> X = np.array([[-1, -1], [-2, -1], [-3, -2], [1, 1], [2, 1], [3, 2]])
       >>> kde = KernelDensity(kernel='gaussian', bandwidth=0.2).fit(X)
       >>> kde.score_samples(X)
       array([-0.41075698, -0.41075698, -0.41076071, -0.41075698, -0.41075698,
              -0.41076071])

    لقد استخدمنا هنا ``kernel='gaussian'`` ، كما هو موضح أعلاه.
    من الناحية الرياضية ، النواة هي عبارة عن دالة موجبة :math:`K(x;h)`
    التي يتم التحكم فيها بواسطة معامل عرض النطاق :math:`h`.
    بالنظر إلى هذا النموذج النواة ، يتم إعطاء تقدير الكثافة في نقطة :math:`y` ضمن مجموعة من النقاط :math:`x_i; i=1\cdots N` بواسطة:

    .. math::
        \rho_K(y) = \sum_{i=1}^{N} K(y - x_i; h)

    يعمل عرض النطاق هنا كمعامل تمهيد ، يتحكم في المقايضة بين التحيز والتباين في النتيجة. يؤدي عرض النطاق الكبير إلى توزيع كثافة سلس للغاية (أي تحيز عالي). يؤدي عرض النطاق الصغير إلى توزيع كثافة غير سلس (أي تباين عالي).

    يتحكم معامل `bandwidth` في هذا التمهيد. يمكن للمرء إما تعيين هذا المعامل يدويًا أو استخدام طرق تقدير سكوت وسيلفرمان.

    تنفذ :class:`~sklearn.neighbors.KernelDensity` عدة أشكال نواة شائعة ، والتي تظهر في الشكل التالي:

    .. |kde_kernels| image:: ../auto_examples/neighbors/images/sphx_glr_plot_kde_1d_002.png
       :target: ../auto_examples/neighbors/plot_kde_1d.html
       :scale: 80

    .. centered:: |kde_kernels|

    .. dropdown:: التعبيرات الرياضية للنوى

      شكل هذه النوى هو كما يلي:

      * نواة غاوسية (``kernel = 'gaussian'``)

        :math:`K(x; h) \propto \exp(- \frac{x^2}{2h^2} )`

      * نواة توباك (``kernel = 'tophat'``)

        :math:`K(x; h) \propto 1` إذا :math:`x < h`

      * نواة إيبانشنكوف (``kernel = 'epanechnikov'``)

        :math:`K(x; h) \propto 1 - \frac{x^2}{h^2}`

      * نواة أسية (``kernel = 'exponential'``)

        :math:`K(x; h) \propto \exp(-x/h)`

      * نواة خطية (``kernel = 'linear'``)

        :math:`K(x; h) \propto 1 - x/h` إذا :math:`x < h`

      * نواة جيب الظل (``kernel = 'cosine'``)

        :math:`K(x; h) \propto \cos(\frac{\pi x}{2h})` إذا :math:`x < h`


    يمكن استخدام أداة تقدير كثافة النواة مع أي من مقاييس المسافة الصالحة (انظر :class:`~sklearn.metrics.DistanceMetric` للحصول على قائمة بالمقاييس المتاحة) ، على الرغم من أن النتائج يتم تطبيعها بشكل صحيح فقط لمقياس يوكليدي. أحد المقاييس المفيدة بشكل خاص هو `مسافة هافرين (Haversine distance) <https://en.wikipedia.org/wiki/Haversine_formula>`_
    والتي تقيس المسافة الزاوية بين نقطتين على الكرة. فيما يلي مثال على استخدام تقدير كثافة النواة للتصور بيانات جغرافية مكانية ، في هذه الحالة توزيع ملاحظات نوعين مختلفين على قارة أمريكا الجنوبية:

    .. |species_kde| image:: ../auto_examples/neighbors/images/sphx_glr_plot_species_kde_001.png
       :target: ../auto_examples/neighbors/plot_species_kde.html
       :scale: 80

    .. centered:: |species_kde|

    تطبيق مفيد آخر لتقدير كثافة النواة هو تعلم نموذج توليدي غير بارامتري لمجموعة بيانات من أجل رسم عينات جديدة بكفاءة من هذا النموذج التوليدي.
    فيما يلي مثال على استخدام هذه العملية لإنشاء مجموعة جديدة من الأرقام المكتوبة بخط اليد ، باستخدام نواة غاوسية تم تعلمها على إسقاط PCA للبيانات:

    .. |digits_kde| image:: ../auto_examples/neighbors/images/sphx_glr_plot_digits_kde_sampling_001.png
       :target: ../auto_examples/neighbors/plot_digits_kde_sampling.html
       :scale: 80

    .. centered:: |digits_kde|

    تتكون "البيانات" الجديدة من مجموعات خطية من بيانات الإدخال ، مع أوزان مرسومة احتماليًا بالنظر إلى نموذج KDE.

    .. rubric:: الأمثلة

    * :ref:`sphx_glr_auto_examples_neighbors_plot_kde_1d.py`: حساب تقديرات بسيطة لكثافة النواة في بعد واحد.

    * :ref:`sphx_glr_auto_examples_neighbors_plot_digits_kde_sampling.py`: مثال على استخدام تقدير كثافة النواة لتعلم نموذج توليدي للأرقام المكتوبة بخط اليد
      بيانات ، ورسم عينات جديدة من هذا النموذج.

    * :ref:`sphx_glr_auto_examples_neighbors_plot_species_kde.py`: مثال على تقدير كثافة النواة باستخدام مسافة هافرين لتصور البيانات الجغرافية المكانية.
